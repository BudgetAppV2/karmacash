# Roadmap & Milestones

## Development Approach

KarmaCash follows a structured, milestone-based approach to ensure steady progress and create functional components that build upon each other. This phased approach allows for clear tracking of progress and ensures that the application grows in a logical, sustainable manner. Key architectural decisions may necessitate pivoting the roadmap, as occurred before starting Milestone 4.

## Milestone Overview (Revised Post-M3)

### Pre-M4 Completed Milestones:
- **Milestone 0: Setup & Foundation:** Initial project setup, repo, environment, logging foundation. (Complete)
- **Milestone 1: Authentication & Basic Layout:** Firebase auth, core layout, navigation, user context, protected routes. (Complete)
- **Milestone 2: Core Data (Initial):** User-centric category & transaction CRUD, default categories, UI implementation, toast notifications. (Complete - *Note: Data is user-centric*)
- **Milestone 3: Recurring Transactions & Enhanced Transaction View:** Recurring rules CRUD, UI-triggered Callable Function for generation/deletion, Enhanced Weekly/Monthly views (Calendar), UTC date fixes. (Complete - *Note: Built on user-centric data*)

### --- Architectural Pivot Point (Pre-M4) ---
*Recognized need to refactor core data structure to support high-priority **Shared Budgets** before implementing budgeting features.*

### Milestone 4a: Architectural Refactor for Shared Budgets (Current Focus)
- **Goal:** Redesign and implement the core data structure in Firestore to support collaborative budgeting. This is foundational for future scaling and features.
- **Key Outcomes:** Top-level `budgets` collection, clear membership/permission model, defined relationships for associated data (transactions, categories).

### Milestone 4b: Core Budgeting Logic & UI
- **Goal:** Develop the primary budgeting features, leveraging the new shared data structure.
- **Key Outcomes:** Monthly budget page, category allocation UI, accurate ZBB calculations (Available Funds, Rollover), spending tracking visuals.

### Milestone 5: Analyse et Polissage
Milestone 5 focuses on in-depth analysis, refinement, and polishing of the KarmaCash application. The primary goal is to further stabilize core functionalities, significantly enhance the user experience based on learnings and feedback, and address outstanding technical and UI/UX points. This milestone prepares the application for more extensive testing and eventual deployment.

**Overarching M5 Principle:** All designs and implementations undertaken in M5 will prioritize extensibility for planned Post-MVP features (as outlined in B1.4 PostMVP Features) to minimize future retrofitting and ensure a scalable foundation.

### Milestone 6: Final Testing, Refinement & Deployment
- **Goal:** Ensure a high-quality, reliable MVP ready for initial use or deployment.
- **Key Outcomes:** Thoroughly tested application, final UI polish, performance optimizations, production deployment.

## Detailed Task Breakdown (Revised Post-M3)

*(Tasks for M0-M3 remain as completed historically)*

### Milestone 4a: Architectural Refactor for Shared Budgets (NEW)
- **Design:**
    - Define Firestore schema for top-level `budgets` collection ([B5.2]).
    - Define Membership/Permissions model (e.g., `members` map/subcollection with roles) ([B5.2]).
    - Finalize relationship/linkage strategy for `transactions` to `budgets` ([B5.1]).
    - Determine if `categories` and `recurringRules` need budget linkage or remain user-specific ([B5.1]).
    - Update Bible Data Model section ([B5.X]) with designs & rationale.
    - Define high-level Firestore Security Rules strategy for shared access ([B5.X]).
- **Implementation:**
    - Implement necessary changes to Firestore Schema/Indexes.
    - Refactor `transactionService.js` to handle new linkage to `budgets`.
    - Refactor `categoryService.js` / `recurringRules.js` if linkage changes decided.
    - Implement updated Firestore Security Rules based on design strategy.
- **Testing:**
    - Unit/Integration tests for refactored services.
    - Manual validation of data relationships and security rules.

### Milestone 4b: Core Budgeting Logic & UI (WAS M4)
- *(Prerequisite: M4a Completion)*
- Create `BudgetPage.jsx` UI structure (placeholder areas for funds, categories).
- Implement fetching of relevant `budget` document based on selected month & user access.
- Implement logic/UI for displaying `Available Funds` (Requires careful definition - [B6.1]).
- Implement logic/UI for displaying/handling `Rollover` from previous month ([B6.1]).
- Build `BudgetCategoryRow.jsx` component.
- Implement UI for Category Allocation (e.g., input field per category).
- Implement logic for "Remaining to Allocate" calculation & display (real-time updates).
- Implement saving of allocations to the `budget` document ([B5.2]).
- Implement display of Spending vs. Allocation per category (Requires transaction data query linked to `budgetId` and categories).
- Add basic progress indicators for category spending.
- Add Month Navigation controls for the Budget page.
- Implement core Budget Calculation test cases ([B7.2]).
- Add visual feedback for budget status (e.g., category over/under budget) ([B3.8]).

### Milestone 5: Analyse et Polissage
*(Prerequisite: M4b Completion)*

**Key Objectives & Tasks:**

**Objective 1: Enhance Core Budgeting Logic & User Experience**
*   Implement "Reste à Allouer" non-negative constraint.
    *   *(Corresponds to M5.1.1: Implement Input Validation for Category Allocations to Prevent Negative "Reste à Allouer")*
*   Design, implement, and integrate "Allocation Sliders" for budget allocation.
    *   *(Corresponds to M5.1.2: Design and Implement "Allocation Sliders" UI Component & M5.1.3: Integrate Allocation Sliders with Budget Logic and "Reste à Allouer" Constraint)*
*   Review and update the backend mechanism for saving user budget allocations.
    *   *(Corresponds to M5.1.4: Review and Update Backend for Saving Allocations)*
*   Address "Fonds Disponibles" UI clarification (e.g., via tooltip or info icon) to explain its calculation, assuming the recurring expense category toggle feature is deferred to Post-MVP.

**Objective 2: Refine Application Structure & User Interaction**
*   Enhance Navigation UX, focusing on intuitive flows, smooth transitions, and clear active states.
    *   *(Incorporates and refines previous "Improve overall Navigation UI" and "Enhance Navigation UX (transitions, active states)")*
*   Implement the 'Graphiques' (Charts/Analysis) section UI framework.
    *   Add Expense Distribution Pie Chart (fetching and displaying relevant transaction data).
    *   Add Income vs. Expense vs. Balance Bar Chart.
*   Implement the 'Catégories' (Categories Analysis) section UI, displaying transactions grouped by category within a selected period.
*   Implement the Header Balance Toggle functionality (logic may depend on budgeting calculations from M4b).
*   Implement View Mode and Date Persistence across relevant application sections.
*   Define the Dashboard concept, its functional scope, and create an initial UI/UX design.
*   Polish Login and Signup page UI and overall user experience.
*   Define and implement the application's behavior when a user attempts to delete a category that has existing allocations or transactions.
*   Clarify and document navigation paths for category management within the KarmaCash Bible (`B3.4` or relevant sections).
*   Identify, document, and specify component requirements for Toast notifications within the KarmaCash Bible (`B3.7`).
*   Implement responsive design refinements across the application based on populated views and new sections.

**Objective 3: Prepare for Future Growth & Stability**
*   Conduct a thorough review and validation of the `recalculateBudget` server-side function to ensure accuracy and robustness.
*   Process the consolidated list of Persistent Notes: categorize each item (Bug, Tech Debt, Feature, UI Polish) and prioritize their assignment to M5, M6, or Post-MVP.
*   Prepare a detailed design and technical plan for the user Onboarding feature. (The final decision on its implementation in M6 vs. Post-MVP will be made later in M5).

**Objective 4: Strategic Analysis & Process Improvement**
*   Analyze the Commercialization Model, focusing on the viability and implications of a one-time purchase option. Document findings and decisions (update `B1.5` if needed).
*   Explore Task Manager Integration: research and evaluate tools (e.g., Claude Task Master) for compatibility with the AI-assisted workflow (SHIP/Cursor) and plan a trial if a suitable tool is identified.
*   Research and Evaluate Modern UI/UX Tools & Techniques that could benefit KarmaCash's design and development process or user experience.

### Milestone 6: Final Testing, Refinement & Deployment (WAS M7)
- *(Prerequisite: M5 Completion)*
- End-to-end testing of all core user flows (Auth, Tx, Budgeting).
- Cross-browser & Multi-device testing.
- Final UI polish (animations, transitions, visual consistency review).
- Performance review & optimization (lazy loading, code splitting, query optimization).
- Firestore Security Rules final review and hardening.
- Comprehensive error handling review.
- Production environment setup/configuration.
- Deployment to Firebase Hosting.
- Basic maintenance/backup plan documentation.

## Timeline Estimate (Revised Post-M3)

- **Milestone 4a (Refactor):** ~4-7 sessions (8-14 hours) - *High uncertainty, critical path.*
- **Milestone 4b (Budgeting):** ~7-10 sessions (14-20 hours) - *Similar to original M4 estimate.*
- **Milestone 5 (Analysis):** ~5-7 sessions (10-14 hours) - *Depends on complexity.*
- **Milestone 6 (Testing/Deploy):** ~3-5 sessions (6-10 hours) - *Standard estimate.*

**Revised Estimated MVP (M0-M6) Range**: Approximately 38-59 sessions (76-118 hours). Note this incorporates the significant refactoring effort. *Actual duration highly dependent on M4a complexity.*

## Development Dependencies (Revised)

1.  **M0-M3 → M4a (Refactor)**: The user-centric implementation works but limits future features. Refactor is needed for sharing.
2.  **M4a (Refactor) → M4b (Budgeting)**: Core budgeting *must* be built on the new shared data architecture.
3.  **M4b (Budgeting) → M5 (Analysis)**: Analysis views depend on budget data and related transactions being correctly structured and calculated.
4.  **M5 → M6 (Testing/Deploy)**: All core features needed for comprehensive testing before deployment.

## Post-MVP Roadmap

Following the MVP (completion of M6), development will focus on features prioritized in [B1.4], beginning with Shared Budget UI/UX refinements (permissions management, invites etc.), Goal Setting, and Push Notifications.